# ============================================
# TeamPass Helm Chart - Example Values
# ============================================
# Copy this file and customize for your environment
# Usage: helm install teampass ./teampass -f values-custom.yaml

# ----------------------------------------
# Image Configuration
# ----------------------------------------
image:
  repository: teampass/teampass
  tag: "sha256:6afa42c4071b2400f2d4995654776ff42dbccea96c2b87ebfcf4d29c7e672edf"
  pullPolicy: IfNotPresent

# -----------------------------6-----------
# Service Configuration
# ----------------------------------------
service:
  type: ClusterIP
  port: 80

# ----------------------------------------
# Ingress Configuration
# ----------------------------------------
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "120"
  hosts:
    - host: teampass.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: teampass-tls
      hosts:
        - teampass.example.com

# ----------------------------------------
# Resources
# ----------------------------------------
resources:
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

# ----------------------------------------
# Autoscaling
# ----------------------------------------
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# ----------------------------------------
# TeamPass Application Configuration
# ----------------------------------------
teampass:
  installMode: auto
  adminEmail: admin@example.com
  adminPassword: ChangeMeToSecurePassword123!
  url: https://teampass.box72.ru
  php:
    memoryLimit: 512M
    uploadMaxFilesize: 100M
    maxExecutionTime: 120
  dbPrefix: teampass_

# ----------------------------------------
# MariaDB Configuration
# ----------------------------------------
mariadb:
  enabled: true
  architecture: standalone
  # Global FIPS setting - use 'relaxed' for compatibility with Yandex Cloud Kubernetes
  # Allowed values: '', 'restricted', 'relaxed', 'off'
  global:
    defaultFips: "relaxed"
  auth:
    database: teampass
    username: teampass
    password: ""  # Auto-generated
    rootPassword: ""  # Auto-generated
  primary:
    persistence:
      enabled: true
      storageClass: ""
      size: 20Gi
    resources:
      requests:
        memory: "512Mi"
        cpu: "250m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    # FIPS mode configuration - must match global.defaultFips
    fips:
      openssl: "relaxed"
    # Increase probe delays to allow for full MariaDB initialization
    # First startup can take 5+ minutes for database setup
    livenessProbe:
      enabled: true
      initialDelaySeconds: 600
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 6
      successThreshold: 1
    readinessProbe:
      enabled: true
      initialDelaySeconds: 120
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 6
      successThreshold: 1
    # Increase startup wait options for slow initialization
    startupWaitOptions:
      retries: 600
      waitTime: 2

# ----------------------------------------
# Persistent Storage
# ----------------------------------------
persistence:
  sk:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 1Gi
  files:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
  upload:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi

# ----------------------------------------
# Health Checks
# ----------------------------------------
healthCheck:
  enabled: true
  path: /health
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

# ----------------------------------------
# Network Policy
# ----------------------------------------
networkPolicy:
  enabled: false

# ----------------------------------------
# Pod Disruption Budget
# ----------------------------------------
pdb:
  enabled: true
  minAvailable: 1
