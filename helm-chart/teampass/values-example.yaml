# ============================================
# TeamPass Helm Chart - Example Values
# ============================================
# Copy this file and customize for your environment
# Usage: helm install teampass ./teampass -f values-custom.yaml

# ----------------------------------------
# Image Configuration
# ----------------------------------------
# Кастомный образ с исправленным PHP-FPM user (nginx вместо www-data)
# Базовый образ: php:8.3-fpm-alpine3.21 (минимум уязвимостей)
image:
  repository: ghcr.io/your-username/teampass-custom
  tag: "latest-alpine3.21"
  pullPolicy: IfNotPresent

# -----------------------------6-----------
# Service Configuration
# ----------------------------------------
service:
  type: ClusterIP
  port: 80

# ----------------------------------------
# Ingress Configuration
# ----------------------------------------
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "120"
  hosts:
    - host: teampass.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: teampass-tls
      hosts:
        - teampass.example.com

# ----------------------------------------
# Resources
# ----------------------------------------
resources:
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

# ----------------------------------------
# Autoscaling
# ----------------------------------------
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# ----------------------------------------
# TeamPass Application Configuration
# ----------------------------------------
teampass:
  installMode: auto
  adminEmail: admin@example.com
  adminPassword: ChangeMeToSecurePassword123!
  url: https://teampass.box72.ru
  php:
    memoryLimit: 512M
    uploadMaxFilesize: 100M
    maxExecutionTime: 120
  dbPrefix: teampass_

# ----------------------------------------
# MariaDB Configuration
# ----------------------------------------
mariadb:
  enabled: true
  architecture: standalone
  auth:
    database: teampass
    username: teampass
    password: ""  # Auto-generated
    rootPassword: ""  # Auto-generated
    usePasswordFiles: false
  primary:
    ## Replica Count: 1
    replicaCount: 1
    ## MariaDB Configuration
    configuration: |-
      [mysqld]
      skip-name-resolve
      explicit_defaults_for_timestamp
      basedir=/opt/bitnami/mariadb
      datadir=/bitnami/mariadb/data
      plugin_dir=/opt/bitnami/mariadb/plugin
      port=3306
      socket=/opt/bitnami/mariadb/tmp/mysql.sock
      tmpdir=/opt/bitnami/mariadb/tmp
      max_allowed_packet=16M
      bind-address=*
      pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
      log-error=/opt/bitnami/mariadb/logs/mysqld.log
      character-set-server=UTF8
      collation-server=utf8_general_ci
      slow_query_log=0
      long_query_time=10.0
      # character-set-server=utf8mb4
      # collation-server=utf8mb4_unicode_ci
      # max_allowed_packet=64M
      # innodb_buffer_pool_size=256M

      [client]
      port=3306
      socket=/opt/bitnami/mariadb/tmp/mysql.sock
      default-character-set=UTF8
      plugin_dir=/opt/bitnami/mariadb/plugin
    persistence:
      enabled: true
      storageClass: ""
      size: 20Gi
    resources:
      requests:
        memory: "512Mi"
        cpu: "250m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    startupProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 30
      successThreshold: 1
    livenessProbe:
      enabled: true
      initialDelaySeconds: 120
      periodSeconds: 10
      timeoutSeconds: 1
      failureThreshold: 3
      successThreshold: 1
    readinessProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 1
      failureThreshold: 3
      successThreshold: 1
    service:
      type: ClusterIP
      ports:
        mysql: 3306
        metrics: 9104
      clusterIP: ""
    ## Pod Disruption Budget
    pdb:
      create: false
    ## Network Policy (optional)
    networkPolicy:
      enabled: false

# ----------------------------------------
# Persistent Storage
# ----------------------------------------
persistence:
  sk:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 1Gi
  files:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
  upload:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi

# ----------------------------------------
# Health Checks
# ----------------------------------------
healthCheck:
  enabled: true
  path: /health
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

# ----------------------------------------
# Network Policy
# ----------------------------------------
networkPolicy:
  enabled: false

# ----------------------------------------
# Pod Disruption Budget
# ----------------------------------------
pdb:
  enabled: true
  minAvailable: 1
