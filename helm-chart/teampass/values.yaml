# ============================================
# TeamPass Helm Chart Default Values
# ============================================

# ----------------------------------------
# Image Configuration
# ----------------------------------------
# По умолчанию используется кастомный образ с исправленным PHP-FPM user
# Оригинал: teampass/teampass
# Кастомный: ghcr.io/your-username/teampass-custom (PHP-FPM работает от nginx)
# Базовый образ: php:8.3-fpm-alpine3.21 (минимум уязвимостей на 2026 г.)
# См. docker/Dockerfile для деталей
image:
  repository: ghcr.io/your-username/teampass-custom
  tag: "latest-alpine3.21"
  pullPolicy: IfNotPresent

# Image pull secrets
imagePullSecrets: []

# Name overrides
nameOverride: ""
fullnameOverride: ""

# ----------------------------------------
# Service Account
# ----------------------------------------
serviceAccount:
  create: true
  annotations: {}
  name: ""

# ----------------------------------------
# Pod Security Context
# ----------------------------------------
podSecurityContext: {}
  # fsGroup: 2000

# ----------------------------------------
# Security Context
# ----------------------------------------
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# ----------------------------------------
# Service Configuration
# ----------------------------------------
service:
  type: ClusterIP
  port: 80
  targetPort: 80
  annotations: {}

# ----------------------------------------
# Ingress Configuration
# ----------------------------------------
ingress:
  enabled: false
  className: nginx
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: teampass.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: teampass-tls
  #    hosts:
  #      - teampass.local

# ----------------------------------------
# Resources
# ----------------------------------------
resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512M"
    cpu: "500m"

# ----------------------------------------
# Autoscaling
# ----------------------------------------
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# ----------------------------------------
# Node Selector
# ----------------------------------------
nodeSelector: {}

# ----------------------------------------
# Tolerations
# ----------------------------------------
tolerations: []

# ----------------------------------------
# Affinity
# ----------------------------------------
affinity: {}

# ----------------------------------------
# Pod Disruption Budget
# ----------------------------------------
pdb:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1

# ----------------------------------------
# Database Configuration (external)
# ----------------------------------------
externalDatabase:
  enabled: false
  host: ""
  port: 3306
  database: teampass
  user: teampass
  password: ""
  prefix: teampass_

# ----------------------------------------
# MariaDB Sub-chart Configuration
# ----------------------------------------
mariadb:
  enabled: true
  architecture: standalone
  auth:
    database: teampass
    username: teampass
    password: ""  # Auto-generated
    rootPassword: ""  # Auto-generated
    usePasswordFiles: false
  primary:
    ## Replica Count: 1
    replicaCount: 1
    ## MariaDB Configuration
    configuration: |-
      [mysqld]
      skip-name-resolve
      explicit_defaults_for_timestamp
      basedir=/opt/bitnami/mariadb
      datadir=/bitnami/mariadb/data
      plugin_dir=/opt/bitnami/mariadb/plugin
      port=3306
      socket=/opt/bitnami/mariadb/tmp/mysql.sock
      tmpdir=/opt/bitnami/mariadb/tmp
      max_allowed_packet=16M
      bind-address=*
      pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
      log-error=/opt/bitnami/mariadb/logs/mysqld.log
      character-set-server=UTF8
      collation-server=utf8_general_ci
      slow_query_log=0
      long_query_time=10.0
      # character-set-server=utf8mb4
      # collation-server=utf8mb4_unicode_ci
      # max_allowed_packet=64M
      # innodb_buffer_pool_size=256M

      [client]
      port=3306
      socket=/opt/bitnami/mariadb/tmp/mysql.sock
      default-character-set=UTF8
      plugin_dir=/opt/bitnami/mariadb/plugin
    persistence:
      enabled: true
      storageClass: ""
      size: 20Gi
    resources:
      requests:
        memory: "512Mi"
        cpu: "250m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    startupProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 30
      successThreshold: 1
    livenessProbe:
      enabled: true
      initialDelaySeconds: 120
      periodSeconds: 10
      timeoutSeconds: 1
      failureThreshold: 3
      successThreshold: 1
    readinessProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 1
      failureThreshold: 3
      successThreshold: 1
    service:
      type: ClusterIP
      ports:
        mysql: 3306
        metrics: 9104
      clusterIP: ""
    ## Pod Disruption Budget
    pdb:
      create: false
    ## Network Policy (optional)
    networkPolicy:
      enabled: false

# ----------------------------------------
# TeamPass Application Configuration
# ----------------------------------------
teampass:
  # Installation mode: manual | auto
  installMode: manual
  
  # Admin credentials (for auto installation)
  adminEmail: admin@teampass.local
  adminPassword: ""
  
  # Application URL
  url: http://localhost
  
  # PHP Configuration
  php:
    memoryLimit: 512M
    uploadMaxFilesize: 100M
    maxExecutionTime: 120
  
  # Database prefix
  dbPrefix: teampass_

# ----------------------------------------
# Environment Variables
# ----------------------------------------
env: []
  # - name: CUSTOM_VAR
  #   value: "custom-value"

# ----------------------------------------
# Persistent Volume Claims
# ----------------------------------------
persistence:
  sk:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 1Gi
  files:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 5Gi
  upload:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 5Gi

# ----------------------------------------
# Health Checks
# ----------------------------------------
healthCheck:
  enabled: true
  path: /health
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3
  successThreshold: 1

# ----------------------------------------
# Network Policy
# ----------------------------------------
networkPolicy:
  enabled: false
  # ingressRules: []
  # egressRules: []

# ----------------------------------------
# Secrets (auto-generated if empty)
# ----------------------------------------
secrets:
  dbPassword: ""
  mariadbRootPassword: ""
